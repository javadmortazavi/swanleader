<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ÙØ±Ù… Ø«Ø¨Øª Ù†ÛŒÙˆØ¨Ù„Ø§Ø¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ -->
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.css">

  <style>
    body { font-family: Tahoma, sans-serif; background-color: #f5f5f5; padding: 2rem; direction: rtl; }
    form { background: #fff; padding: 2rem; border-radius: 8px; max-width: 900px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,.08); }
    label { font-weight: bold; display: block; margin-top: 1rem; }
    input, select, textarea { width: 100%; padding: 0.5rem; margin-top: 0.3rem; border: 1px solid #ccc; border-radius: 6px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

    .installments, .coins-log, .referred-container { margin-top: 1rem; }

    /* Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ */
    .installment, .coin-entry, .referred-entry {
      background: #f0f0f0; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem;
      display: grid; gap: .5rem; align-items:center;
    }
    .installment { grid-template-columns: repeat(4, minmax(160px, 1fr)); }
    .coin-entry  { grid-template-columns: minmax(160px,1fr) minmax(220px,2fr) auto; }
    .referred-entry { grid-template-columns: 1fr auto; }

    .muted { color:#777; font-size:.9rem; }
    button { margin-top: 1rem; padding: 0.6rem 1.5rem; background-color: #009688; color: white; border: none; border-radius: 6px; cursor: pointer; }

    .stars span { font-size: 1.6rem; cursor: pointer; color: #c9c9c9; }
    .stars .selected { color: #f4c430; }

    .pdate-input { direction: ltr; text-align: center; }
    input[type="file"] { width: 100%; }

    /* ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ */
    @media (max-width: 900px) {
      .row { grid-template-columns: 1fr; }
    }
    @media (max-width: 700px) {
      .installment { grid-template-columns: 1fr; }
      .coin-entry  { grid-template-columns: 1fr; }
      .referred-entry { grid-template-columns: 1fr; }
      .installment > button,
      .coin-entry  > button,
      .referred-entry > button {
        width: 100%; order: 99; margin-top: .25rem;
      }
    }

    /* ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† */
    #backupSection { display: none; margin: 2rem auto; max-width: 800px; padding: 1rem; background: #fff; border-radius: 6px; box-shadow: 0 4px 10px rgba(0,0,0,.1); }
  </style>
</head>
<body>

  <h2 style="text-align:center">ÙØ±Ù… Ø«Ø¨Øª Ù†ÛŒÙˆØ¨Ù„Ø§Ø¯</h2>

  <form id="newbloodForm">
    <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
    <input type="text" name="name" required>

    <label>Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
    <input type="text" name="mobile" required>

    <label>Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</label>
    <input type="text" name="instagram">

    <div class="row">
      <div>
        <label>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</label>
        <input type="text" id="birthdate" class="pdate-input" name="birthdate">
      </div>
      <div>
        <label>ØªØ§Ø±ÛŒØ® Ø¯ÙˆØ±Ù‡</label>
        <input type="text" id="course_date" class="pdate-input" name="course_date">
      </div>
    </div>

    <label>Ù…Ø­Ù„ Ø¯ÙˆØ±Ù‡</label>
    <input type="text" name="course_location">

    <label>Ø§Ø³ØªØ§Ù†</label>
    <input type="text" name="province">

    <label>Ø´Ù‡Ø±</label>
    <input type="text" name="city">

    <label>Ø´ØºÙ„â€ŒÙ‡Ø§</label>
    <input type="text" name="jobs" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø±Ø¨ÛŒ ÛŒÙˆÚ¯Ø§ØŒ ØªØ±Ø§Ù¾ÛŒØ³Øª">

    <label>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§</label>
    <input type="text" name="skills" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§Ø³Ø§Ú˜ØŒ Ù…Ø¯ÛŒØªÛŒØ´Ù†">

    <label>Ù†Ø­ÙˆÙ‡ Ø¢Ø´Ù†Ø§ÛŒÛŒ</label>
    <input type="text" name="referral_source" placeholder="Ù…Ø«Ø§Ù„: Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…ØŒ Ø¯ÙˆØ³ØªØ§Ù†">

    <label>Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</label>
    <input type="text" name="interests" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÛŒÙˆØ±ÙˆØ¯Ø§ØŒ Ø³ÙØ±ØŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ">

    <label>Ù…Ø¹Ø±ÙÛŒâ€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§</label>
    <div id="referredList"></div>
    <button type="button" onclick="addReferred()">+ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¹Ø±ÙÛŒâ€ŒØ´Ø¯Ù‡</button>

    <label>Ø³Ø·Ø­ Ø±Ø´Ø¯</label>
    <div class="stars" id="growthStars">
      <span data-val="1">â˜…</span>
      <span data-val="2">â˜…</span>
      <span data-val="3">â˜…</span>
      <span data-val="4">â˜…</span>
      <span data-val="5">â˜…</span>
    </div>
    <input type="hidden" name="growth" id="growthInput" value="0">

    <!-- Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª -->
    <label>Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª</label>
    <input type="number" step="0.01" name="prepayment">

    <!-- Ø§Ù‚Ø³Ø§Ø· -->
    <div class="installments">
      <label>Ø§Ù‚Ø³Ø§Ø·</label>
      <div id="installmentsList"></div>
      <button type="button" onclick="addInstallment()">+ Ø§ÙØ²ÙˆØ¯Ù† Ù‚Ø³Ø·</button>
    </div>

    <!-- Ø³ÙˆØ§Ù† Ú©ÙˆÛŒÙ† -->
    <div class="coins-log">
      <label>Ø³ÙˆØ§Ù† Ú©ÙˆÛŒÙ†</label>
      <div id="coinsList"></div>
      <button type="button" onclick="addCoin()">+ Ø§ÙØ²ÙˆØ¯Ù† Ú©ÙˆÛŒÙ†</button>
    </div>

    <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
    <textarea name="notes"></textarea>

    <button type="submit">Ø«Ø¨Øª</button>
  </form>

  <!-- Ø¨Ø®Ø´ Ø¨Ú©Ø§Ù¾ (ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ†) -->
  <div id="backupSection">
    <h3>ğŸ“¦ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
    <button onclick="downloadBackup()">Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ JSON</button>
    <pre id="backupLog" style="background:#eee;padding:1rem;border-radius:6px;max-height:200px;overflow:auto;"></pre>
  </div>

  <script>
    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
    ['#birthdate','#course_date'].forEach(sel=>{
      $(sel).persianDatepicker({
        format: 'YYYY/MM/DD',
        autoClose: true
      });
    });

    // Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø´Ø¯
    const stars = document.querySelectorAll('#growthStars span');
    const growthInput = document.getElementById('growthInput');
    stars.forEach(star=>{
      star.addEventListener('click', ()=>{
        const val = star.getAttribute('data-val');
        growthInput.value = val;
        stars.forEach(s=>s.classList.remove('selected'));
        for(let i=0;i<val;i++) stars[i].classList.add('selected');
      });
    });

    // Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ù‚Ø³Ø§Ø·
    function addInstallment(){
      const div=document.createElement('div');
      div.className='installment';
      div.innerHTML=`
        <input type="text" placeholder="ØªØ§Ø±ÛŒØ® Ù‚Ø³Ø·" class="pdate-input">
        <input type="number" placeholder="Ù…Ø¨Ù„Øº">
        <input type="file">
        <button type="button" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>`;
      document.getElementById('installmentsList').appendChild(div);
      $(div.querySelector('.pdate-input')).persianDatepicker({format:'YYYY/MM/DD',autoClose:true});
    }

    // Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ú©ÙˆÛŒÙ†
    function addCoin(){
      const div=document.createElement('div');
      div.className='coin-entry';
      div.innerHTML=`
        <input type="text" placeholder="ØªØ§Ø±ÛŒØ®" class="pdate-input">
        <input type="text" placeholder="ØªÙˆØ¶ÛŒØ­">
        <button type="button" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>`;
      document.getElementById('coinsList').appendChild(div);
      $(div.querySelector('.pdate-input')).persianDatepicker({format:'YYYY/MM/DD',autoClose:true});
    }

    // Ù…Ø¹Ø±ÙÛŒâ€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§
    function addReferred(){
      const div=document.createElement('div');
      div.className='referred-entry';
      div.innerHTML=`
        <input type="text" placeholder="Ù†Ø§Ù… Ù…Ø¹Ø±ÙÛŒâ€ŒØ´Ø¯Ù‡">
        <button type="button" onclick="this.parentElement.remove()">Ø­Ø°Ù</button>`;
      document.getElementById('referredList').appendChild(div);
    }

    // Ø«Ø¨Øª ÙØ±Ù…
    document.getElementById('newbloodForm').addEventListener('submit', e=>{
      e.preventDefault();
      alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø§ÛŒÙ†Ø¬Ø§ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Backendless Ø¨Ø§ÛŒØ¯ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯)');
    });

    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø®Ø´ Ø¨Ú©Ø§Ù¾ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
    if (window.location.search.includes('admin=true')) {
      document.getElementById('backupSection').style.display = 'block';
    }

    // Ø¨Ú©Ø§Ù¾ Ø¯ÛŒØªØ§ (Ù…Ø«Ø§Ù„)
    async function downloadBackup(){
      // Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² Backendless Ù‡Ù…Ù‡ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ú¯ÛŒØ±ÛŒ
      const dummyData = [{name:"Ali",mobile:"0912...",city:"Tehran"}];
      const blob = new Blob([JSON.stringify(dummyData,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download="backup.json"; a.click();
      URL.revokeObjectURL(url);
      document.getElementById('backupLog').innerText="Ø¨Ú©Ø§Ù¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ ("+new Date().toLocaleString()+")";
    }
  </script>
</body>
</html>
