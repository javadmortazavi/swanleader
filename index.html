<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>فرم ثبت نیوبلاد</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- کتابخانه تقویم شمسی -->
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.css">

  <style>
    body { font-family: Tahoma, sans-serif; background-color: #f5f5f5; padding: 2rem; direction: rtl; }
    form { background: #fff; padding: 2rem; border-radius: 8px; max-width: 900px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,.08); }
    label { font-weight: bold; display: block; margin-top: 1rem; }
    input, select, textarea { width: 100%; padding: 0.5rem; margin-top: 0.3rem; border: 1px solid #ccc; border-radius: 6px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

    .installments, .coins-log, .referred-container { margin-top: 1rem; }

    /* بلوک‌های داخلی */
    .installment, .coin-entry, .referred-entry {
      background: #f0f0f0; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem;
      display: grid; gap: .5rem; align-items:center;
    }
    .installment { grid-template-columns: repeat(4, minmax(160px, 1fr)); }
    .coin-entry  { grid-template-columns: minmax(160px,1fr) minmax(220px,2fr) auto; }
    .referred-entry { grid-template-columns: 1fr auto; }

    .muted { color:#777; font-size:.9rem; }
    button { margin-top: 1rem; padding: 0.6rem 1.5rem; background-color: #009688; color: white; border: none; border-radius: 6px; cursor: pointer; }

    .stars span { font-size: 1.6rem; cursor: pointer; color: #c9c9c9; }
    .stars .selected { color: #f4c430; }

    /* ورودی تاریخ */
    .pdate-input { direction: ltr; text-align: center; }
    input[type="file"] { width: 100%; }

    /* واکنش‌گرا */
    @media (max-width: 900px) {
      .row { grid-template-columns: 1fr; }
    }
    @media (max-width: 700px) {
      .installment { grid-template-columns: 1fr; }
      .coin-entry  { grid-template-columns: 1fr; }
      .referred-entry { grid-template-columns: 1fr; }
      .installment > button,
      .coin-entry  > button,
      .referred-entry > button {
        width: 100%; order: 99; margin-top: .25rem;
      }
    }
  </style>
</head>
<body>

  <h2 style="text-align:center">فرم ثبت نیوبلاد</h2>

  <form id="newbloodForm">
    <label>نام و نام خانوادگی</label>
    <input type="text" name="name" required>

    <label>موبایل</label>
    <input type="text" name="mobile" required>

    <label>اینستاگرام</label>
    <input type="text" name="instagram">

    <div class="row">
      <div>
        <label>تاریخ تولد</label>
        <input type="text" id="birthdate" class="pdate-input" name="birthdate">
      </div>
      <div>
        <label>تاریخ دوره</label>
        <input type="text" id="course_date" class="pdate-input" name="course_date">
      </div>
    </div>

    <label>محل دوره</label>
    <input type="text" name="course_location">

    <label>استان</label>
    <input type="text" name="province">

    <label>شهر</label>
    <input type="text" name="city">

    <label>سطح رشد</label>
    <div class="stars" id="growthStars">
      <span data-val="1">★</span>
      <span data-val="2">★</span>
      <span data-val="3">★</span>
      <span data-val="4">★</span>
      <span data-val="5">★</span>
    </div>
    <input type="hidden" name="growth" id="growthInput" value="0">

    <!-- اقساط -->
    <div class="installments">
      <label>اقساط</label>
      <div id="installmentsList"></div>
      <button type="button" onclick="addInstallment()">+ افزودن قسط</button>
    </div>

    <!-- سوان کوین -->
    <div class="coins-log">
      <label>سوان کوین</label>
      <div id="coinsList"></div>
      <button type="button" onclick="addCoin()">+ افزودن کوین</button>
    </div>

    <label>پیش‌پرداخت</label>
    <input type="number" step="0.01" name="prepayment">

    <label>یادداشت</label>
    <textarea name="notes"></textarea>

    <button type="submit">ثبت</button>
  </form>

  <script>
    // فعال‌سازی تاریخ شمسی
    ['#birthdate','#course_date'].forEach(sel=>{
      new persianDate().toLocale('fa');
      $(sel).persianDatepicker({
        format: 'YYYY/MM/DD',
        autoClose: true
      });
    });

    // ستاره‌های رشد
    const stars = document.querySelectorAll('#growthStars span');
    const growthInput = document.getElementById('growthInput');
    stars.forEach(star=>{
      star.addEventListener('click', ()=>{
        const val = star.getAttribute('data-val');
        growthInput.value = val;
        stars.forEach(s=>s.classList.remove('selected'));
        for(let i=0;i<val;i++) stars[i].classList.add('selected');
      });
    });

    // داینامیک اقساط
    function addInstallment(){
      const div=document.createElement('div');
      div.className='installment';
      div.innerHTML=`
        <input type="text" placeholder="تاریخ قسط" class="pdate-input">
        <input type="number" placeholder="مبلغ">
        <input type="file">
        <button type="button" onclick="this.parentElement.remove()">حذف</button>`;
      document.getElementById('installmentsList').appendChild(div);
      $(div.querySelector('.pdate-input')).persianDatepicker({format:'YYYY/MM/DD',autoClose:true});
    }

    // داینامیک کوین
    function addCoin(){
      const div=document.createElement('div');
      div.className='coin-entry';
      div.innerHTML=`
        <input type="text" placeholder="تاریخ" class="pdate-input">
        <input type="text" placeholder="توضیح">
        <button type="button" onclick="this.parentElement.remove()">حذف</button>`;
      document.getElementById('coinsList').appendChild(div);
      $(div.querySelector('.pdate-input')).persianDatepicker({format:'YYYY/MM/DD',autoClose:true});
    }

    // ثبت فرم
    document.getElementById('newbloodForm').addEventListener('submit', e=>{
      e.preventDefault();
      alert('اطلاعات ذخیره شد (اینجا اتصال به Backendless باید انجام شود)');
    });
  </script>
</body>
</html>
